# === Per-key tiers ===
DEFAULT_TIER=FREE
# Tier definitions
KEY_TIER_FREE_RPM=30
KEY_TIER_FREE_DAY=1000
KEY_TIER_STARTER_RPM=60
KEY_TIER_STARTER_DAY=5000
KEY_TIER_PRO_RPM=300
KEY_TIER_PRO_DAY=50000
KEY_TIER_ENTERPRISE_RPM=1200
KEY_TIER_ENTERPRISE_DAY=500000

# Map concrete API keys (plaintext shown here for example; store only hashes in DB for prod)
# KEY_MAP_<PLAINTEXT_API_KEY>=<TIERNAME>
KEY_MAP_public=FREE

# === Backpressure ===
POLICY_MAX_CONCURRENCY=4
MAX_QUEUE=100

# === F0 Engine ===
F0_SAFE_THRESHOLD=0.5
F0_SYNERGY_SCALE=0.05

# === Security mandatory ===
# Set a strong JWT secret in production (>=16 chars)
JWT_SECRET=change_me_in_prod_please

# === CORS allowlist (comma-separated) ===
CORS_ALLOWED_ORIGINS=https://app.soulsync.example,https://admin.soulsync.example

# === Redis for idempotency and rate limiting ===
REDIS_URL=redis://localhost:6379
RPM_TOKENS=0  # 0 = use tier rpm; >0 override rpm for apiKeyRateLimit


# === CSP ===
CSP_REPORT_ONLY=false
CSP_DIRECTIVE=default-src 'self'; img-src 'self' data:; font-src 'self' data:; object-src 'none'; base-uri 'self'; frame-ancestors 'self'


# === Progest-E module ===
PROGESTE_FEATURE_ENABLED=true
SUPPL_AI_SUMMARY_ENABLED=false


# === Ops RCA ===
# Optional webhook for daily AI Ops RCA summary (Slack/Teams compatible)
OPS_RCA_WEBHOOK=
OPS_RCA_LOOKBACK_HOURS=24

# To enforce CSP after QA:
# CSP_REPORT_ONLY=false


# === Log retention ===
LOG_RETENTION_DAYS=14


# === CSP report endpoint (optional) ===
# FRONTEND can set report-uri to point to backend:
# e.g., CSP_DIRECTIVE=default-src 'self'; ...; report-uri /csp-report
CSP_REPORT_URI=/csp-report


# === Security hardening ===
FORCE_HSTS=false   # set true after HTTPS is confirmed end-to-end


# === Body limits & shutdown ===
JSON_BODY_LIMIT=1mb
FORM_BODY_LIMIT=1mb
SHUTDOWN_TIMEOUT_MS=10000

# === Route deprecation mapping (JSON) ===
# Example: {"\/api\/old-endpoint":{"sunset":"Wed, 31 Dec 2025 23:59:59 GMT","link":"https://docs/old","alt":"/api/new-endpoint"}}
DEPRECATE_ROUTES={}


# === Maintenance mode ===
MAINTENANCE_MODE=false


# === HTTPS redirect (behind proxy) ===
FORCE_HTTPS=false


# === Log rotation ===
MAX_LOG_SIZE_MB=50


# === AI Ops RCA TL;DR (plain text) ===
OPS_RCA_AI_TLDR_ENABLED=false


# Set to false to ENFORCE CSP once frontend CSP is clean:
# CSP_REPORT_ONLY=false


# === Pregnenolone supplement module ===
PREGNENOLONE_FEATURE_ENABLED=true


# === Supplements safety gating ===
# When true, dose logging & summary require plan.clinicianOk=true
SUPPL_REQUIRE_CLINICIAN_OK=false


# === Sentry sampling (tuning) ===
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.0


# === Webhook verification ===
# Single secret or per-route map (x-signature: sha256=...)
WEBHOOK_SECRET=
# WEBHOOK_SECRETS={"example":"supersecret"}

# CSP in enforce mode by default; set to true for report-only during QA


# === DB performance ===
DB_SLOW_MS=200
# Optional log retention in days (applies to *.ndjson and *.gz in logs/)
LOG_RETENTION_DAYS=30


# === Observability dashboards ===
# If set, /ops/heatmap redirects here
GRAFANA_DASH_URL=


# === Optional security hardening (may affect iframes/workers) ===
ENABLE_COOP_COEP=false


# === /ops/config-diff allow-list (comma-separated env keys) ===
OPS_CONFIG_DIFF_KEYS=NODE_ENV,CSP_REPORT_ONLY,MAINTENANCE_MODE,SUPPL_REQUIRE_CLINICIAN_OK,PREGNENOLONE_FEATURE_ENABLED,PROGESTE_FEATURE_ENABLED


# === Notifications ===
SLACK_WEBHOOK_URL=
DISCORD_WEBHOOK_URL=
SMTP_URL=
NOTIFY_EMAIL_TO=
NOTIFY_EMAIL_FROM=
# Set to 1 to suppress runtime notifications
NO_NOTIFY=0


# === Performance ===
COMPRESSION_ENABLED=true # enable in stage/prod for better bandwidth

# === Supplements safety linter ===
SUPPL_SAFETY_LINT_ENABLED=true


# === Optional context for safety lint (UI may send it; backend does not use ENV here) ===
# WEIGHT_KG is not read by backend; pass weightKg per-request in JSON if needed.


# === Ops alerts (anomaly-hints based) ===
OPS_ALERTS_ENABLED=false
OPS_ALERT_THRESHOLD_ERRRATE=0.05
OPS_ALERT_THRESHOLD_AVGMS=500
OPS_ALERT_COOLDOWN_SEC=600


# === Ops alerts token (optional) ===
OPS_ALERT_TOKEN=
